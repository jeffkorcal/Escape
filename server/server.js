////////////////////////////////////////////////
//Modules
////////////////////////////////////////////////
var express = require('express');
var mongoose = require('mongoose');
var app = express();


////////////////////////////////////////////////
//Configure Middleware & Routes
////////////////////////////////////////////////
require('./config/middleware.js')(app, express);
require('./config/routes.js')(app, express);


////////////////////////////////////////////////
//Database
////////////////////////////////////////////////
mongoose.connect('mongodb://localhost/escape');
var db = mongoose.connection;
db.on('error', console.error);
db.once('open', function() {
  console.log('database connected');
});


////////////////////////////////////////////////
//Start Server
////////////////////////////////////////////////
app.listen(8000, function() {
  console.log('listening on port 8000');
});

module.exports = app;
